<script type="text/javascript">
  $(function(){
    $("#projects-tree").fancytree({
      extensions: ["persist"],
      persist: {
        expandLazy: true,
        overrideSource: false, 
        store: "auto" 
      }
    });

    $( "a.collapse_projects").click(function(){
      $("#projects-tree").fancytree("getRootNode").visit(function(node){
        node.setExpanded(false);
      });
    });
    $( "a.expand_projects").click(function(){
      $("#projects-tree").fancytree("getRootNode").visit(function(node){
        node.setExpanded(true);
      });
    });
    $( "a.toggle_projects").click(function(){
      $("#projects-tree").fancytree("getRootNode").visit(function(node){
        node.toggleExpanded();
      });
    });

  });  
</script>

<a class="expand_projects" href="#"><%= l(:expand_all) %></a>/<a class="collapse_projects" href="#"><%= l(:collapse_all) %></a><br />

<div id="projects-tree">
<%= raw "#{projects_tree}" %>
</div>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'style_projects_tree', :plugin => 'redmine_projects_tree' %>
  <%= stylesheet_link_tag 'style_fancytree', :plugin => 'redmine_projects_tree' %>
  <%= javascript_include_tag 'jquery_fancytree_cookie', :plugin => 'redmine_projects_tree' %>
  <%= javascript_include_tag 'jquery_fancytree_min', :plugin => 'redmine_projects_tree' %>
  <%= javascript_include_tag 'jquery_fancytree_persist', :plugin => 'redmine_projects_tree' %>
<% end %>
